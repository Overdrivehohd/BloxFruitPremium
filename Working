if not game:IsLoaded() then game.Loaded:Wait() end

local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- [[ CONFIGURATION ]]
local WHITELIST_URL = "https://raw.githubusercontent.com/Overdrivehohd/whitelist.txt/refs/heads/main/lol"
local WEBHOOK_URL = "https://discord.com/api/webhooks/1123007471062093877/EOC4O5ZYe6xBo9TmsONKKAMwE8y9ptjWByz3WTaq5MuxwI2fMpCmmj0R8jpnlsZMdf7T" 

-- [[ WEBHOOK LOGGER FUNCTION ]]
local function LogToDiscord(status)
    local data = {
        ["embeds"] = {{
            ["title"] = "ðŸ”’ script execution log",
            ["description"] = "a user has executed the script.",
            ["color"] = status == "Authorized" and 65280 or 16711680,
            ["fields"] = {
                {["name"] = "username", ["value"] = player.Name:lower(), ["inline"] = true},
                {["name"] = "display name", ["value"] = player.DisplayName:lower(), ["inline"] = true},
                {["name"] = "user id", ["value"] = tostring(player.UserId), ["inline"] = true},
                {["name"] = "status", ["value"] = status:lower(), ["inline"] = false},
                {["name"] = "game", ["value"] = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name:lower(), ["inline"] = false}
            },
            ["footer"] = {["text"] = "security system v1.1"},
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }}
    }
    
    pcall(function()
        local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
        if request then
            request({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(data)
            })
        end
    end)
end

-- [[ 0. GITHUB WHITELIST CHECK ]]
local function CheckWhitelist()
    local success, result = pcall(function() 
        return game:HttpGet(WHITELIST_URL .. "?t=" .. tick()) 
    end)
    if success then
        local myName = player.Name:lower()
        -- Try JSON Decode
        local decodeSuccess, whitelist = pcall(function() return HttpService:JSONDecode(result) end)
        if decodeSuccess and type(whitelist) == "table" then
            for _, name in pairs(whitelist) do
                if myName == tostring(name):lower() then return true end
            end
        else
            -- Plain Text Fallback
            for name in result:gmatch("[^\r\n]+") do
                if myName == name:lower():gsub("%s+", "") then return true end
            end
        end
    end
    return false
end

-- [[ GATEKEEPER LOGIC ]]
if not CheckWhitelist() then
    LogToDiscord("Denied Access")
    
    -- RUN RAINBOW CHAOS (Access Denied Screen)
    local pGui = player:WaitForChild("PlayerGui")
    local sg = Instance.new("ScreenGui", pGui)
    sg.Name = "RainbowChaosGui"; sg.IgnoreGuiInset = true; sg.DisplayOrder = 100000000 

    local img = Instance.new("ImageLabel", sg)
    img.Size = UDim2.new(1, 0, 1, 0); img.BorderSizePixel = 0
    img.Image = "rbxassetid://116219679482062"; img.ScaleType = Enum.ScaleType.Fit

    local deniedText = Instance.new("TextLabel", sg)
    deniedText.Size = UDim2.new(1, 0, 0, 100); deniedText.Position = UDim2.new(0, 0, 0.5, -50)
    deniedText.BackgroundTransparency = 1; deniedText.Text = "ACCESS DENIED - NOT WHITELISTED"
    deniedText.TextColor3 = Color3.fromRGB(255, 0, 0); deniedText.Font = "GothamBold"
    deniedText.TextSize = 45; deniedText.TextStrokeTransparency = 0; deniedText.TextWrapped = true

    local sound = Instance.new("Sound", game.Workspace)
    sound.SoundId = "rbxassetid://136496379743350"; sound.Volume = 10; sound.Looped = true; sound:Play()

    task.spawn(function()
        local hue = 0
        while true do
            hue = hue + (1/300)
            img.BackgroundColor3 = Color3.fromHSV(hue % 1, 1, 1)
            task.wait()
        end
    end)
    return -- Stops the rest of the script
end

-- [[ AUTHORIZED ACCESS ]]
LogToDiscord("Authorized")

-- [[ 1. FIREBASE TOKEN FETCH ]]
local DISCORD_TOKEN = ""
task.spawn(function()
    local firebase_url = "https://prpjectlol-default-rtdb.firebaseio.com/token.json"
    local success, result = pcall(function() return game:HttpGet(firebase_url) end)
    if success and result ~= "null" then
        DISCORD_TOKEN = result:gsub('"', ''):gsub("%s+", "")
    end
end)

-- [[ 2. SCANNER CONFIG ]]
local CHANNEL_ID = "1426479580784361482" 
local SETTINGS_FILE = "SkiddedSettings.json"
local SCAN_DELAY = 0.5 
local ALERT_SOUND_ID = "rbxassetid://5476307813"
-- I renamed 'Whitelist' to 'PriorityList' here to avoid clashing with the security check
local ScannerEnabled, AutoJoinEnabled, MinValue, TotalFound, Blacklist, PriorityList, LoopingJID, LogHistory = false, false, 0, 0, {}, {}, nil, {}

local function SaveSettings()
    local data = {Priority = PriorityList, Blacklist = Blacklist, MinVal = MinValue}
    if writefile then pcall(function() writefile(SETTINGS_FILE, HttpService:JSONEncode(data)) end) end
end

if isfile and isfile(SETTINGS_FILE) then
    local success, content = pcall(function() return readfile(SETTINGS_FILE) end)
    if success then
        local decoded = HttpService:JSONDecode(content)
        PriorityList = decoded.Priority or {}; Blacklist = decoded.Blacklist or {}; MinValue = decoded.MinVal or 0
    end
end

-- [[ 3. SCANNER GUI ]]
local scannerGui = Instance.new("ScreenGui", game:GetService("CoreGui")); scannerGui.Name = "SkiddedLoversV1"
local main = Instance.new("Frame", scannerGui); main.Size = UDim2.new(0, 380, 0, 450); main.Position = UDim2.new(0.5, -190, 0.5, -225); main.BackgroundColor3 = Color3.fromRGB(25, 26, 30); main.Active = true; Instance.new("UICorner", main).CornerRadius = UDim.new(0, 8)

local stroke = Instance.new("UIStroke", main); stroke.Thickness = 2; stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
task.spawn(function()
    while main.Parent do
        for i = 0, 1, 0.005 do
            stroke.Color = Color3.fromHSV(i, 1, 1)
            task.wait(0.01)
        end
    end
end)

-- Draggable Logic
local dragging, dragStart, startPos
main.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; dragStart = input.Position; startPos = main.Position end end)
UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then local delta = input.Position - dragStart; main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)
UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

local counter = Instance.new("TextLabel", main); counter.Size = UDim2.new(1,0,0,35); counter.Text = "ðŸ¾ found: 0"; counter.TextColor3 = Color3.fromRGB(255, 255, 255); counter.Font = "GothamBold"; counter.BackgroundTransparency = 1; counter.TextSize = 12
local minInput = Instance.new("TextBox", main); minInput.Size = UDim2.new(0.9, 0, 0, 35); minInput.Position = UDim2.new(0.05, 0, 0, 45); minInput.PlaceholderText = "min value: " .. MinValue .. "m"; minInput.BackgroundColor3 = Color3.fromRGB(15, 16, 20); minInput.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", minInput)
minInput.FocusLost:Connect(function() MinValue = tonumber(minInput.Text:match("%d+%.?%d*")) or MinValue; SaveSettings(); minInput.PlaceholderText = "min: " .. MinValue .. "m"; minInput.Text = "" end)

local blInput = Instance.new("TextBox", main); blInput.Size = UDim2.new(0.43, 0, 0, 30); blInput.Position = UDim2.new(0.05, 0, 0, 135); blInput.PlaceholderText = "add blacklist"; blInput.BackgroundColor3 = Color3.fromRGB(15, 16, 20); blInput.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", blInput)
local wlInput = Instance.new("TextBox", main); wlInput.Size = UDim2.new(0.43, 0, 0, 30); wlInput.Position = UDim2.new(0.52, 0, 0, 135); wlInput.PlaceholderText = "add priority"; wlInput.BackgroundColor3 = Color3.fromRGB(15, 16, 20); wlInput.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", wlInput)
blInput.FocusLost:Connect(function(e) if e and blInput.Text ~= "" then table.insert(Blacklist, blInput.Text:lower()); SaveSettings(); blInput.Text = "" end end)
wlInput.FocusLost:Connect(function(e) if e and wlInput.Text ~= "" then table.insert(PriorityList, wlInput.Text:lower()); SaveSettings(); wlInput.Text = "" end end)

local scanBtn = Instance.new("TextButton", main); scanBtn.Size = UDim2.new(0.43, 0, 0, 35); scanBtn.Position = UDim2.new(0.05, 0, 0, 90); scanBtn.Text = "scan: off"; scanBtn.BackgroundColor3 = Color3.fromRGB(40, 41, 45); scanBtn.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", scanBtn)
local autoBtn = Instance.new("TextButton", main); autoBtn.Size = UDim2.new(0.43, 0, 0, 35); autoBtn.Position = UDim2.new(0.52, 0, 0, 90); autoBtn.Text = "auto: off"; autoBtn.BackgroundColor3 = Color3.fromRGB(40, 41, 45); autoBtn.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", autoBtn)

local feedScroll = Instance.new("ScrollingFrame", main); feedScroll.Size = UDim2.new(0.9, 0, 0, 260); feedScroll.Position = UDim2.new(0.05, 0, 0, 175); feedScroll.BackgroundColor3 = Color3.fromRGB(10, 11, 15); feedScroll.BorderSizePixel = 0; Instance.new("UICorner", feedScroll)
local feedLayout = Instance.new("UIListLayout", feedScroll); feedLayout.Padding = UDim.new(0, 4); feedLayout.SortOrder = Enum.SortOrder.LayoutOrder

local function addToFeed(petName, val, jid, pCount, isPriority)
    if isPriority then local s = Instance.new("Sound", game:GetService("SoundService")); s.SoundId = ALERT_SOUND_ID; s.Volume = 2; s:Play(); game:GetService("Debris"):AddItem(s, 5) end
    local f = Instance.new("Frame", feedScroll); f.Size = UDim2.new(1, -10, 0, 45); f.BackgroundColor3 = isPriority and Color3.fromRGB(0, 70, 35) or Color3.fromRGB(35, 36, 42); Instance.new("UICorner", f); f.LayoutOrder = isPriority and -1 or 1 
    local t = Instance.new("TextLabel", f); t.Size = UDim2.new(0.55, 0, 1, 0); t.Position = UDim2.new(0.05, 0, 0, 0); t.Text = petName:lower() .. " (" .. val .. "m) [" .. pCount .. "]"; t.TextColor3 = Color3.new(1,1,1); t.BackgroundTransparency = 1; t.TextXAlignment = "Left"; t.TextSize = 8; t.TextWrapped = true
    local j = Instance.new("TextButton", f); j.Size = UDim2.new(0.15, 0, 0.7, 0); j.Position = UDim2.new(0.62, 0, 0.15, 0); j.Text = "join"; j.BackgroundColor3 = Color3.fromRGB(0, 120, 255); j.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", j); j.TextSize = 10
    local lp = Instance.new("TextButton", f); lp.Size = UDim2.new(0.18, 0, 0.7, 0); lp.Position = UDim2.new(0.79, 0, 0.15, 0); lp.Text = "loop"; lp.BackgroundColor3 = Color3.fromRGB(80, 80, 80); lp.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", lp); lp.TextSize = 10
    j.MouseButton1Click:Connect(function() TeleportService:TeleportToPlaceInstance(game.PlaceId, jid, player) end)
    lp.MouseButton1Click:Connect(function() if LoopingJID == jid then LoopingJID = nil; lp.Text = "loop"; lp.BackgroundColor3 = Color3.fromRGB(80, 80, 80) else LoopingJID = jid; lp.Text = "active"; lp.BackgroundColor3 = Color3.fromRGB(200, 0, 0) end end)
    feedScroll.CanvasSize = UDim2.new(0, 0, 0, feedLayout.AbsoluteContentSize.Y); TotalFound = TotalFound + 1; counter.Text = "ðŸ¾ found: " .. TotalFound
end

task.spawn(function() while true do if LoopingJID then pcall(function() TeleportService:TeleportToPlaceInstance(game.PlaceId, LoopingJID, player) end) end task.wait(1.5) end end)
scanBtn.MouseButton1Click:Connect(function() ScannerEnabled = not ScannerEnabled; scanBtn.Text = ScannerEnabled and "scan: on" or "scan: off"; scanBtn.BackgroundColor3 = ScannerEnabled and Color3.fromRGB(0, 150, 80) or Color3.fromRGB(40, 41, 45) end)
autoBtn.MouseButton1Click:Connect(function() AutoJoinEnabled = not AutoJoinEnabled; autoBtn.Text = AutoJoinEnabled and "auto: on" or "auto: off"; autoBtn.BackgroundColor3 = AutoJoinEnabled and Color3.fromRGB(0, 150, 80) or Color3.fromRGB(40, 41, 45) end)

-- [[ 4. MAIN LOOP ]]
task.spawn(function()
    while true do
        if ScannerEnabled and DISCORD_TOKEN ~= "" then
            pcall(function()
                local req = (request or http_request or (http and http.request))
                local res = req({Url = "https://corsproxy.io/?https://discord.com/api/v9/channels/" .. CHANNEL_ID .. "/messages?limit=10", Method = "GET", Headers = { ["Authorization"] = DISCORD_TOKEN }})
                if res and res.StatusCode == 200 then
                    local messages = HttpService:JSONDecode(res.Body)
                    for i = #messages, 1, -1 do
                        local data = messages[i]
                        if data and not LogHistory[data.id] then
                            LogHistory[data.id] = true
                            local blob = ""
                            if data.embeds and data.embeds[1] then
                                local em = data.embeds[1]; blob = (em.title or "") .. "\n" .. (em.description or "")
                                for _, v in pairs(em.fields or {}) do blob = blob .. "\n" .. (v.name or "") .. " " .. (v.value or "") end
                            end
                            local jid = string.match(blob, "[%w%-]+%-%w+%-%w+%-%w+%-%w+")
                            local val = tonumber(string.match(blob, "(%d+%.?%d*)M")) or 0
                            local petName = blob:match("Name:[%s\n]*([^ðŸ¾ðŸ’Ž\n]+)") or "pet"
                            local pCount = blob:match("Players:[%s\n]*(%d+/%d+)") or "??/??"
                            local isPriority = false
                            for _, w in pairs(PriorityList) do if string.find(petName:lower(), w:lower()) then isPriority = true break end end
                            local isBl = false
                            for _, b in pairs(Blacklist) do if string.find(petName:lower(), b:lower()) then isBl = true break end end
                            if jid and (isPriority or (not isBl and val >= MinValue)) then
                                addToFeed(petName, val, jid, pCount, isPriority)
                                if (AutoJoinEnabled or isPriority) and game.JobId ~= jid then TeleportService:TeleportToPlaceInstance(game.PlaceId, jid, player) end
                            end
                        end
                    end
                end
            end)
        end
        task.wait(SCAN_DELAY)
    end
end)
